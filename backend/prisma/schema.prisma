generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  
  
}

model Navigation {
  id             Int       @id @default(autoincrement())
  title          String
  slug           String    @unique
  sourceUrl      String    @unique
  lastScrapedAt  DateTime?

  categories     Category[]

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Category {
  id             Int       @id @default(autoincrement())
  title          String
  slug           String
  sourceUrl      String    @unique
  productCount   Int?
  lastScrapedAt  DateTime?

  navigationId   Int
  navigation     Navigation @relation(fields: [navigationId], references: [id])

  parentId       Int?
  parent         Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children       Category[] @relation("CategoryHierarchy")

  products       Product[]

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@unique([navigationId, slug])
}

model Product {
  id             Int       @id @default(autoincrement())
  sourceId       String    @unique
  title          String
  author         String?
  price          String?
  currency       String?
  imageUrl       String?
  sourceUrl      String    @unique
  lastScrapedAt  DateTime?

  categoryId     Int
  category       Category  @relation(fields: [categoryId], references: [id])

  detail         ProductDetail?
  reviews        Review[]

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model ProductDetail {
  id             Int       @id @default(autoincrement())
  description    String?
  specs          Json?
  ratingsAvg     Float?
  reviewsCount   Int?

  productId      Int       @unique
  product        Product   @relation(fields: [productId], references: [id])

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Review {
  id             Int       @id @default(autoincrement())
  author         String?
  rating         Int?
  text           String?
  createdAt      DateTime  @default(now())

  productId      Int
  product        Product   @relation(fields: [productId], references: [id])
}
